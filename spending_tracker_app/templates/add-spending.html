<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses Tracker - Home</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        header ul {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #333;
            display: flex;
        }
        header ul li {
            padding: 14px 20px;
        }
        header ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        header ul li a:hover {
            color: #f4b400;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4b400;
            color: white;
            cursor: pointer;
        }
        .earned {
            background-color: lightgreen;
            color: darkgreen;
        }
        .spent {
            background-color: lightcoral;
            color: darkred;
        }
        .filters {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .filters label {
            font-weight: bold;
        }
        .filters select, .filters input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        button {
            padding: 6px 12px;
            background-color: #f4b400;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #e0a800;
        }
        .totals, .summary {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 350px;
            border-radius: 8px;
            z-index: 1000;
        }
        .modal h3 {
            margin-top: 0;
        }
        .modal label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        .modal input, .modal select, .modal textarea {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .modal textarea {
            height: 60px;
            resize: vertical;
        }
        .modal button {
            margin-top: 10px;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <header>
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#" onclick="openTransactionForm()">Add Spending / Earning</a></li>
            <li><a href="#">Charts</a></li>
            <li><a href="#">Plan</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="signup.html">Sign Up</a></li>
        </ul>
    </header>

    <main>
        <h2>Welcome to Expense Tracker</h2>
        <p>Track your daily spendings and earnings effortlessly.</p>

        <div class="filters">
            <label for="filterStatus">Filter:</label>
            <select id="filterStatus">
                <option value="all">All</option>
                <option value="spent">Only Spent</option>
                <option value="earned">Only Earned</option>
            </select>
            <label for="filterCategory">Category:</label>
            <select id="filterCategory">
                <option value="">All Categories</option>
            </select>
            <label for="startDate">From:</label>
            <input type="date" id="startDate">
            <label for="endDate">To:</label>
            <input type="date" id="endDate">
            <label for="displayCurrency">Display Currency:</label>
            <select id="displayCurrency">
                <option value="QAR">QAR</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
            </select>
            <button onclick="applyFilters()">Apply Filters</button>
            <button onclick="openCategoryForm()">Add Category</button>
        </div>

        <table id="expenseTable">
            <thead>
                <tr>
                    <th onclick="sortTable()">Date ‚¨ç</th>
                    <th>Status</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Currency</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2025-05-05</td>
                    <td class="spent">Spent</td>
                    <td>Food</td>
                    <td>5</td>
                    <td>QAR</td>
                    <td>Lunch at cafe</td>
                    <td>
                        <button onclick="editTransaction(this)">Edit</button>
                        <button onclick="deleteTransaction(this)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="totals">
            <p>Total Earned: <span id="totalEarned">0</span> <span id="earnedCurrency">QAR</span></p>
            <p>Total Spent: <span id="totalSpent">0</span> <span id="spentCurrency">QAR</span></p>
        </div>
        <div class="summary" id="summary"></div>
    </main>

    <!-- Add Transaction Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="transactionModal">
        <h3>Add Transaction</h3>
        <form id="transactionForm">
            <label for="amount">Amount:</label>
            <input type="number" id="amount" required min="0" step="0.01">
            <label for="currency">Currency:</label>
            <select id="currency" required>
                <option value="QAR">QAR</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
            </select>
            <label for="status">Spent/Earned:</label>
            <select id="status" required>
                <option value="">Choose</option>
                <option value="spent">Spent</option>
                <option value="earned">Earned</option>
            </select>
            <label for="category">Category:</label>
            <select id="category" required>
                <option value="">Choose Category</option>
            </select>
            <label for="date">Date:</label>
            <input type="date" id="date" required>
            <label for="description">Description:</label>
            <textarea id="description" required></textarea>
            <button type="button" onclick="addTransaction()">Add</button>
            <button type="button" onclick="closeTransactionForm()">Cancel</button>
        </form>
    </div>

    <!-- Edit Transaction Modal -->
    <div class="modal" id="editModal">
        <h3>Edit Transaction</h3>
        <form id="editForm">
            <label for="editAmount">Amount:</label>
            <input type="number" id="editAmount" required min="0" step="0.01">
            <label for="editCurrency">Currency:</label>
            <select id="editCurrency" required>
                <option value="QAR">QAR</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
            </select>
            <label for="editStatus">Spent/Earned:</label>
            <select id="editStatus" required>
                <option value="">Choose</option>
                <option value="spent">Spent</option>
                <option value="earned">Earned</option>
            </select>
            <label for="editCategory">Category:</label>
            <select id="editCategory" required>
                <option value="">Choose Category</option>
            </select>
            <label for="editDate">Date:</label>
            <input type="date" id="editDate" required>
            <label for="editDescription">Description:</label>
            <textarea id="editDescription" required></textarea>
            <button type="button" onclick="updateTransaction()">Save</button>
            <button type="button" onclick="closeEditForm()">Cancel</button>
        </form>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="categoryModal">
        <h3>Add Category</h3>
        <form id="categoryForm">
            <label for="newCategory">Category Name:</label>
            <input type="text" id="newCategory" required placeholder="Enter category...">
            <button type="button" onclick="addCategory()">Add</button>
            <button type="button" onclick="closeCategoryForm()">Cancel</button>
        </form>
    </div>

    <script>
        let categories = ["Food"];
        const apiKey = "YOUR_API_KEY_HERE"; // Replace with your exchangerate-api.com key
        const baseCurrency = "QAR"; // Default base currency

        // Modal Functions
        function openTransactionForm() {
            populateCategoryDropdown("category");
            document.getElementById("transactionModal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closeTransactionForm() {
            document.getElementById("transactionModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
            document.getElementById("transactionForm").reset();
        }
        function openEditForm() {
            populateCategoryDropdown("editCategory");
            document.getElementById("editModal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closeEditForm() {
            document.getElementById("editModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
        function openCategoryForm() {
            document.getElementById("categoryModal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closeCategoryForm() {
            document.getElementById("categoryModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
            document.getElementById("categoryForm").reset();
        }

        // Category Management
        function populateCategoryDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Choose Category</option>';
            categories.forEach(category => {
                select.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }
        function populateFilterCategoryDropdown() {
            const select = document.getElementById("filterCategory");
            select.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                select.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }
        function addCategory() {
            const newCategory = document.getElementById("newCategory").value.trim();
            if (!newCategory || categories.includes(newCategory)) {
                alert("Please enter a unique category name!");
                return;
            }
            categories.push(newCategory);
            populateCategoryDropdown("category");
            populateCategoryDropdown("editCategory");
            populateFilterCategoryDropdown();
            closeCategoryForm();
        }

        // Currency Conversion
        async function convertCurrency(amount, fromCurrency, toCurrency) {
            try {
                const response = await fetch(`https://v6.exchangerate-api.com/v6/${apiKey}/latest/${fromCurrency}`);
                const data = await response.json();
                const rate = data.conversion_rates[toCurrency];
                return amount * rate;
            } catch (error) {
                console.error("Currency conversion failed:", error);
                return amount; // Fallback to original amount if API fails
            }
        }

        // Transaction Functions
        async function addTransaction() {
            const amount = parseFloat(document.getElementById("amount").value);
            const currency = document.getElementById("currency").value;
            const status = document.getElementById("status").value;
            const category = document.getElementById("category").value;
            const date = document.getElementById("date").value;
            const description = document.getElementById("description").value;

            if (!amount || !currency || !status || !category || !date || !description) {
                alert("Please fill all fields!");
                return;
            }

            const table = document.querySelector("#expenseTable tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${date}</td>
                <td class="${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</td>
                <td>${category}</td>
                <td>${amount}</td>
                <td>${currency}</td>
                <td>${description}</td>
                <td>
                    <button onclick="editTransaction(this)">Edit</button>
                    <button onclick="deleteTransaction(this)">Delete</button>
                </td>
            `;
            table.appendChild(row);

            closeTransactionForm();
            await updateDisplayCurrency();
        }

        function editTransaction(button) {
            const row = button.closest("tr");
            const date = row.cells[0].textContent;
            const status = row.cells[1].textContent.toLowerCase();
            const category = row.cells[2].textContent;
            const amount = row.cells[3].textContent;
            const currency = row.cells[4].textContent;
            const description = row.cells[5].textContent;

            document.getElementById("editAmount").value = amount;
            document.getElementById("editCurrency").value = currency;
            document.getElementById("editStatus").value = status;
            document.getElementById("editCategory").value = category;
            document.getElementById("editDate").value = date;
            document.getElementById("editDescription").value = description;

            document.getElementById("editForm").dataset.rowIndex = row.rowIndex;
            openEditForm();
        }

        async function updateTransaction() {
            const rowIndex = document.getElementById("editForm").dataset.rowIndex;
            const table = document.querySelector("#expenseTable tbody");
            const row = table.rows[rowIndex - 1];

            const newAmount = parseFloat(document.getElementById("editAmount").value);
            const newCurrency = document.getElementById("editCurrency").value;
            const newStatus = document.getElementById("editStatus").value;
            const newCategory = document.getElementById("editCategory").value;
            const newDate = document.getElementById("editDate").value;
            const newDescription = document.getElementById("editDescription").value;

            if (!newAmount || !newCurrency || !newStatus || !newCategory || !newDate || !newDescription) {
                alert("Please fill all fields!");
                return;
            }

            row.cells[0].textContent = newDate;
            row.cells[1].textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
            row.cells[1].className = newStatus;
            row.cells[2].textContent = newCategory;
            row.cells[3].textContent = newAmount;
            row.cells[4].textContent = newCurrency;
            row.cells[5].textContent = newDescription;

            closeEditForm();
            await updateDisplayCurrency();
        }

        function deleteTransaction(button) {
            if (confirm("Are you sure you want to delete this transaction?")) {
                button.closest("tr").remove();
                updateDisplayCurrency();
            }
        }

        // Filter and Display
        async function applyFilters() {
            const filterStatus = document.getElementById("filterStatus").value;
            const filterCategory = document.getElementById("filterCategory").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            const rows = document.querySelectorAll("#expenseTable tbody tr");
            rows.forEach(row => {
                const dateCell = row.cells[0].textContent;
                const statusCell = row.cells[1].textContent.toLowerCase();
                const categoryCell = row.cells[2].textContent;
                const rowDate = new Date(dateCell);

                let showRow = true;
                if (startDate && rowDate < new Date(startDate)) showRow = false;
                if (endDate && rowDate > new Date(endDate)) showRow = false;
                if (filterStatus !== "all" && !statusCell.includes(filterStatus)) showRow = false;
                if (filterCategory && categoryCell !== filterCategory) showRow = false;

                row.style.display = showRow ? "" : "none";
            });

            await updateDisplayCurrency();
            showSummary();
        }

        function sortTable() {
            const table = document.getElementById("expenseTable");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            const isAscending = !table.dataset.sortDirection || table.dataset.sortDirection === "desc";

            rows.sort((a, b) => {
                const dateA = new Date(a.cells[0].textContent);
                const dateB = new Date(b.cells[0].textContent);
                return isAscending ? dateA - dateB : dateB - dateA;
            });

            rows.forEach(row => tbody.appendChild(row));
            table.dataset.sortDirection = isAscending ? "asc" : "desc";
            updateDisplayCurrency();
        }

        async function updateDisplayCurrency() {
            const targetCurrency = document.getElementById("displayCurrency").value;
            const rows = document.querySelectorAll("#expenseTable tbody tr");
            let totalEarned = 0;
            let totalSpent = 0;

            for (const row of rows) {
                if (row.style.display !== "none") {
                    const amount = parseFloat(row.cells[3].textContent);
                    const fromCurrency = row.cells[4].textContent;
                    const status = row.cells[1].textContent.toLowerCase();
                    const convertedAmount = await convertCurrency(amount, fromCurrency, targetCurrency);
                    row.cells[3].textContent = convertedAmount.toFixed(2);
                    row.cells[4].textContent = targetCurrency;

                    if (status === "earned") totalEarned += convertedAmount;
                    else if (status === "spent") totalSpent += convertedAmount;
                }
            }

            document.getElementById("totalEarned").textContent = totalEarned.toFixed(2);
            document.getElementById("totalSpent").textContent = totalSpent.toFixed(2);
            document.getElementById("earnedCurrency").textContent = targetCurrency;
            document.getElementById("spentCurrency").textContent = targetCurrency;
        }

        function showSummary() {
            const filterStatus = document.getElementById("filterStatus").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;
            const summaryDiv = document.getElementById("summary");

            if (filterStatus === "all" && startDate && endDate) {
                const totalEarned = parseFloat(document.getElementById("totalEarned").textContent);
                const totalSpent = parseFloat(document.getElementById("totalSpent").textContent);
                if (totalSpent > totalEarned) {
                    summaryDiv.textContent = "You spent more than you earned in this period.";
                    summaryDiv.style.color = "darkred";
                } else if (totalEarned > totalSpent) {
                    summaryDiv.textContent = "You earned more than you spent in this period.";
                    summaryDiv.style.color = "darkgreen";
                } else {
                    summaryDiv.textContent = "Your earnings and spendings are equal in this period.";
                    summaryDiv.style.color = "black";
                }
            } else {
                summaryDiv.textContent = "";
            }
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            populateCategoryDropdown("category");
            populateCategoryDropdown("editCategory");
            populateFilterCategoryDropdown();
            updateDisplayCurrency();
        });
    </script>
</body>
</html>